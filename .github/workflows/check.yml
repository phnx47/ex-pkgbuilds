name: â˜£ Check Versions
on:
  schedule:
    - cron: "55 */24 * * *"

jobs:
  check:
    name: â˜£ Check
    runs-on: ubuntu-20.04
    steps:
      - name: ðŸšš Checkout
        uses: actions/checkout@master
        with:
          fetch-depth: 0

      - name: ðŸ›  Install ubuntu deps
        run: sudo apt-get update && sudo apt-get install libssl-dev libcurl4-openssl-dev

      - name: ðŸ”§ Install nvchecker
        run: pip install nvchecker

      - name: â˜¢ Run check.sh
        run: ./check.sh >> new-vers.txt

      - name: ðŸ—ƒ Read new-vers.txt
        id: new-vers
        uses: juliangruber/read-file-action@master
        with:
          trim: false
          path: ./new-vers.txt

      - name: âœ‰ Send email
        if: "endsWith(steps.new-vers.outputs.content, '\n')"
        uses: wadeww/send-email-action@master
        with:
          server_address: smtp.fastmail.com
          port: 465
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          subject: AUR - New Versions
          body: ${{ steps.new-vers.outputs.content }}
          to: arch@phnx47.net
          from: noreply@phnx47.net
