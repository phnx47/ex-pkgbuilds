name: â˜£ Check Versions
on:
  schedule:
    - cron: "55 */8 * * *"
  push:
    branches:
      - "ci/check"

jobs:
  check:
    name: â˜£ Check Versions
    runs-on: ubuntu-20.04
    steps:
      - name: ðŸšš Checkout
        uses: actions/checkout@master
        with:
          fetch-depth: 0

      - name: ðŸ›  Install dependencies
        run: sudo apt-get install libssl-dev libcurl4-openssl-dev

      - name: ðŸ”§ Install nvchecker
        run: pip install nvchecker

      - name: â˜¢ Check versions
        id: check_vers
        shell: bash
        run: echo "::set-output name=new_vers::${./check.sh%$'\n'*}"

      - name: âœ‰ Send email
        uses: wadeww/send-email-action@master
        with:
          server_address: smtp.fastmail.com
          port: 465
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          subject: AUR - New Versions
          body: ${{ join(teps.check_vers.outputs.new_vers, '\n') }}
          to: arch@phnx47.net
          from: noreply@phnx47.net
